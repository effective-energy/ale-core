Основной компонент системы — это централизованный хаб `ale-hub`.
Тут выполняется вся бизнес—логика приложения. В текущей
реализации определены фиксированные четыре вида транзакций
в отношении предметной области размещения заказов, их
выполнения, приёма и оплаты. Расширение возможно только за
счёт явного изменения исходного кода системы.

## dataflow
* Нода (`ale-wallet`) отправляет транзакции на хаб.
* Хаб проверяет их и применяет валидные.
* Состояние системы фиксируется в блокчейне.
* Ноды выкачивают цепочки блоков с
* хаба и отражают состояние системы в своей локальной системе хранения.
* На основе этого состояния строятся ответы на любые запросы к ноде от клиента (в
    браузере или из командной строки).

## Выполнение транзакций
- заказчик размещает предложение о работе (контракт)
    У контракта задана фиксированная цена в токенах. При
    размещении выполняется проверка наличия достаточных
    средств на счету (во внутренних токенах) и эта сумма
    списывается со счёта.
    Предложение добавляется в список открытых предложений
    работодателя.
    `core/src/Ale/State.hs:applyJobOffer`
- исполнитель предложил свою кандидиатуру
    Добавляется в список кандидатов
    `core/src/Ale/State.hs:applyContractorProposal`
- заказчик выбрал исполнителя на работу
    Проверяются соответствие подрядчика требованиям предложения о работе
    Предложение убирается из списка открытых
    Для простых задач сразу выполняется оплата подрядчику
    Сложная задача добавляется в список активных предложений и в список
    задач в разработке
    `core/src/Ale/State.hs:applySubmission`
- заказчик принял работу исполнителя (требуется только для сложных задач)
    Сложная (ещё не оплаченная) работа оплачивается.
    Задача удаляется из списка активных предложений и из списка задач в
    разработке. Удаляются все уже не актуальные предложения кандидатур.
    `core/src/Ale/State.hs:applyEmployerAcceptance`

Транзакции поступают в хаб от нод, по очереди проверяются на применимость к
текущему состоянию. Валидные транзакции добавляются в пул транзакций. Регулярно
раз в 10 секунд все имеющиеся в пуле транзакции оформляются в блок, он
подписывается и добавляется в цепочку. Ноды синхронизируют своё состояние с
хабом, выкачивают цепочки блоков, восстанавливают у себя локально то же
состояние системы по набору транзакций. На все запросы отвечают из этой
локальной версии состояния.

## Первоначальная эмиссия и распределение
Исходное состояние цепочки блоков нужно сгенерировать с
помощью утилит `ale-keychain`, `ale-distribute`, `ale-genesis`
* `ale-keychain` создаёт набор ключей — участников сети.
* `ale-distribute` начисляет заданную сумму (внутреннего
    токена) на указанные аккаунты.
* `ale-genesis` создаёт первый блок сети.
После выпуска первого блока перемещение средств по аккаунтам происходит уже
только в соответствии с запрограммированной бизнес—логикой контрактов.
Ни общее количество токенов, ни распределение их по аккаунтам нельзя
произвольно поменять в рамках имеющихся интерфейсов и имеющимися утилитами.
При этом, тем не менее, весь контроль над корректностью вновь выпускаемых
блоков остаётся на одном централизованном хабе.

В исходный код заложены возможности операций по учёту средств из внешних
платёжных систем: другие криптовалюты или обыкновенные деньги. Практически
операции не реализованы.

## rest-api

Имеется утилита `ale-node-api` для вывода swagger-схемы json-интерфейса api.
Текущий его вариант — в файле docs/node-api.json.

## wallet
`ale-wallet` — это специальный вид ноды, который так же
подключается к хабу, синхронизирует с ним своё состояние,
выкачивая цепочки блоков, и может отправлять ему
сообщения с транзакциями. Особое его предназначение в
том, чтобы служить бэкэндом для клиента в браузере.
В кошелёк зазгружаются аккаунты (вместе с секретными
ключими) пользователя, и далее для любых операций со
средствами на счетах необходим только адрес (публичный
ключ) счёта. Поэтому предполагается что этот компонент
должен запускаться локально на машине пользователя.
Безопасность и сохранность данных должна обеспечиваться
отдельными средствами.

`ale-wallet-api` — запускает сервер, который отдаёт
swagger — схему json-http-интерфейса кошелька
по адресу http://localhost:8080/openapi.json.
Текущий его вариант — в файле docs/wallet-api.json.


----------------------------------------


* Для локального хранения текущего состояния используется `rocksdb`.

* Сообщения приходят в hub-сервер hub/src/Ale/Hub/Mining/Server.hs
    - хаб - это супернода, которая должна запускаться на доверенном сервере
    - проверяются (в т.ч. на наличие доступных средств)
    - добавляются в набор для выпуска в очередном блоке
    - следующий блок выпускается раз в 10 секунд методом `mine`
    - блоки пишутся в `rocksdb`
        hub/src/Ale/Hub/Blockchain/Server.hs (saveBlocks: putDB bPtr b)
    - нет консенсуса, нет общения с другими хабами
    - хаб может отдать блок по хэшу и голову.
        (так же, дождаться появления нового блока и отдать его)
    - хаб при старте начинает новый блокчейн ???

* Каждый участник сети идентифицируется собственным публичным ключём
    - имеет счёт в деньгах и двух видах собственного токена (fuel, transferable).

* Нода
    - общается с хабом по tcp
    - отдаёт наружу json http-api
    - отправляет сообщения в хаб
    - скачивает блокчейн из хаба
